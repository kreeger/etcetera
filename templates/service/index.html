{% extends "root.html" %}
{% load etcetera_tags %}

{% block title %}
   Work Orders
{% endblock %}

{% block breadcrumb %}
   <a href="{% url etcetera-home %}">Home</a> &rsaquo;
   Service
   {% if completed %}
      (Completed)
   {% endif %}
{% endblock %}

{% block content %}
<div id="list">   
   <h1>
      <span class="right">
         <a href="{% url service-new %}">manually add a new work order</a>
      </span>
      {% if completed %}
         Completed
      {% endif %}
      Work Order List
      
      <span class="small">
         <a href="{% if completed %}{% url service-index %}{% else %}{% url service-completed %}{% endif %}">
            view
            {% if completed %}
               active
            {% else %}
               completed
            {% endif %}
         </a>
      </span>
   </h1>
   
   <div id="searchform">
      <form action="">
         {{ form.q }}
         <input type="submit" name="submit" value="Search" id="submit" />
      </form>
      {% if q %}
         <span class="small">
            (<a href=".">searching for "{{ q }}" â€” click here to reset</a>)
         </span>
      {% endif %}
   </div>
   
   <table id="list">
      <tr id="headerrow">
         <td>Submitted by</td>
         <td>Department</td>
         <td>Equipment</td>
         <td>Location</td>
         <td>Priority</td>
         <td>Work type</td>
         <td>
            {% if completed %}
               Completion
            {% else %}
               Creation
            {% endif %}
            date
         </td>
      </tr>
      {% for object in paged_objects.object_list %}
      <tr class="datarow">
         <td>
            <a href="{% url service-detail object.id %}">
               {{ object.first_name }} {{ object.last_name }}
            </a>
         </td>
         <td>
            <a href="{% url service-detail object.id %}">
               {{ object.department }}
            </a>
         </td>
         <td>
            <a href="{% url service-detail object.id %}">
               {% if object.equipment %}
                  {{ object.equipment.make.name }}
                  {{ object.equipment.model }}
               {% else %}
                  {{ object.equipment_text|truncatewords:5 }}
               {% endif %}
            </a>
         </td>
         <td>
            <a href="{% url service-detail object.id %}">
               {% if object.building %}
                  {{ object.building.abbreviation }} {{ object.room }}
               {% else %}
                  {{ object.location_text }}
               {% endif %}
            </a>
         </td>
         <td>
            <a href="{% url service-detail object.id %}" class="priority{{ object.priority }}">
               {{ object.get_priority_display }}
            </a>
         </td>
         <td>
            <a href="{% url service-detail object.id %}">
               {{ object.get_work_type_display }}
            </a>
         </td>
         <td>
            <a href="{% url service-detail object.id %}">
               {% if completed %}
                  {{ object.completion_date|date:'n/j/Y g:iA' }}
               {% else %}
                  {{ object.creation_date|date:'n/j/Y g:iA' }}
               {% endif %}
            </a>
         </td>
      </tr>
      {% endfor %}
   </table>
   
   {% if form.as_url_args %}
      {% paginate form.as_url_args %}
   {% else %}
      {% paginate %}
   {% endif %}
</div>
{% endblock %}